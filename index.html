<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Anamnese - Consultório</title>
    <!-- Tailwind CSS para design responsivo -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Firebase SDK (Versão Compat) para maior estabilidade em scripts simples -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <style>
        body { background-color: #f9fafb; }
        .glass-card { 
            background: white; 
            border-radius: 1rem; 
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1); 
        }
        input:focus, textarea:focus {
            outline: none;
            border-color: #3b82f6;
            ring: 2px;
            ring-color: #3b82f6;
        }
    </style>
</head>
<body class="min-h-screen py-8 px-4">

    <div class="max-w-3xl mx-auto glass-card p-6 md:p-12">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-gray-900 tracking-tight">Ficha de Anamnese</h1>
            <p class="mt-3 text-lg text-gray-600">Preencha as informações abaixo para iniciarmos sua consulta.</p>
        </header>

        <form id="anamneseForm" class="space-y-8">
            <!-- Seção: Identificação -->
            <section>
                <div class="flex items-center mb-4">
                    <div class="bg-blue-600 h-6 w-1 mr-3 rounded-full"></div>
                    <h2 class="text-xl font-bold text-gray-800">Identificação Pessoal</h2>
                </div>
                
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Nome Completo</label>
                        <input type="text" name="nome" required placeholder="Digite seu nome" 
                               class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all">
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">Data de Nascimento</label>
                            <input type="date" name="nascimento" required 
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-1">WhatsApp / Telefone</label>
                            <input type="tel" name="telefone" required placeholder="(00) 00000-0000" 
                                   class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all">
                        </div>
                    </div>
                </div>
            </section>

            <!-- Seção: Saúde -->
            <section class="pt-4">
                <div class="flex items-center mb-4">
                    <div class="bg-blue-600 h-6 w-1 mr-3 rounded-full"></div>
                    <h2 class="text-xl font-bold text-gray-800">Histórico de Saúde</h2>
                </div>

                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Alergias conhecidas?</label>
                        <textarea name="alergias" rows="2" placeholder="Ex: Medicamentos, alimentos, etc."
                                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Uso de medicamentos contínuos?</label>
                        <textarea name="medicamentos" rows="2" placeholder="Liste os medicamentos que toma atualmente."
                                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all"></textarea>
                    </div>

                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-1">Qual o motivo principal da consulta?</label>
                        <textarea name="queixa_principal" required rows="4" placeholder="Descreva brevemente o que você está sentindo ou seu objetivo."
                                  class="w-full px-4 py-3 rounded-lg border border-gray-300 focus:ring-2 focus:ring-blue-500 transition-all"></textarea>
                    </div>
                </div>
            </section>

            <!-- Feedback visual -->
            <div id="messageBox" class="hidden p-4 rounded-lg text-center text-sm font-bold animate-pulse"></div>

            <button type="submit" id="submitBtn" 
                    class="w-full bg-blue-600 text-white font-bold py-4 px-6 rounded-xl hover:bg-blue-700 transform hover:scale-[1.02] transition-all shadow-lg">
                Enviar Informações
            </button>
        </form>

        <footer class="mt-12 text-center text-gray-400 text-xs">
            &copy; 2024 Ficha Digital de Anamnese - Privado e Seguro
        </footer>
    </div>

    <script>
        // CONFIGURAÇÃO FIREBASE FORNECIDA
        const firebaseConfig = {
            apiKey: "AIzaSyA0JuzYmLbJ9HCPXpfxGWQX19NsZenXO0s",
            authDomain: "meu-consultorio-568f0.firebaseapp.com",
            projectId: "meu-consultorio-568f0",
            storageBucket: "meu-consultorio-568f0.firebasestorage.app",
            messagingSenderId: "121957844615",
            appId: "1:121957844615:web:bdd21d6b2507acfb451a22",
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        const form = document.getElementById('anamneseForm');
        const btn = document.getElementById('submitBtn');
        const msg = document.getElementById('messageBox');

        // Função para mostrar mensagens
        function showMsg(text, type) {
            msg.innerText = text;
            msg.className = `p-4 rounded-lg text-center text-sm font-bold block ${
                type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'
            }`;
        }

        // Evento de Envio
        form.onsubmit = async (e) => {
            e.preventDefault();
            
            // Bloqueia o botão para evitar cliques duplos
            btn.disabled = true;
            btn.innerText = "Processando e Enviando...";
            msg.classList.add('hidden');

            // Captura os dados
            const formData = new FormData(form);
            const dados = Object.fromEntries(formData.entries());
            dados.data_envio = new Date().toLocaleString('pt-BR');

            try {
                // Salva na coleção 'fichas'
                await db.collection('fichas').add(dados);

                showMsg("✅ Ficha enviada com sucesso! Você já pode fechar esta página.", "success");
                btn.innerText = "Enviado com Sucesso!";
                form.reset();
            } catch (error) {
                console.error("Erro Firebase:", error);
                showMsg("❌ Erro ao enviar. Verifique se o Firebase está configurado corretamente.", "error");
                btn.disabled = false;
                btn.innerText = "Tentar Novamente";
            }
        };
    </script>
</body>
</html>
